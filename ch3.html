<!DOCTYPE html>
<html>
<head>
    <title>HLS Player Example</title>
    <style>
        /* จัดรูปแบบให้วิดีโอแสดงเต็มความกว้าง */
        #video-container {
            width: 80%;
            margin: 0 auto;
            padding-top: 20px;
        }
    </style>
</head>
<body>

    <div id="video-container">
        <video id="video" controls></video>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        // ลิงก์ที่คุณต้องการเล่น
        var videoUrl = "http://119.59.118.159/live/ch46/xxccxgd134/index.m3u8";

        // อ้างอิงถึงองค์ประกอบวิดีโอใน HTML
        var video = document.getElementById('video');

        // ตรวจสอบว่าเบราว์เซอร์รองรับ HLS ด้วยตัวเองหรือไม่ 
        // (ส่วนใหญ่ Safari จะรองรับโดยไม่ต้องใช้ hls.js)
        if (Hls.isSupported()) {
            // 1. สร้างอินสแตนซ์ของ Hls.js
            var hls = new Hls();
            
            // 2. ผูกอินสแตนซ์ hls.js เข้ากับองค์ประกอบวิดีโอ 
            hls.attachMedia(video);
            
            // 3. กำหนด Listener เมื่อ Hls.js พร้อมแล้ว 
            hls.on(Hls.Events.MEDIA_ATTACHED, function () {
                console.log("Media attached, loading source...");
                
                // 4. โหลดลิงก์ .m3u8 เข้าไป
                hls.loadSource(videoUrl);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
                    console.log("Manifest parsed, quality levels:", data.levels.length);
                    // สามารถเรียก video.play() ที่นี่ได้ หากต้องการให้เล่นอัตโนมัติ 
                    // (แต่เบราว์เซอร์สมัยใหม่อาจบล็อกการเล่นอัตโนมัติหากไม่มีการโต้ตอบจากผู้ใช้)
                    // video.play(); 
                });
            });

            // การจัดการข้อผิดพลาด (สำคัญสำหรับการใช้งานจริง)
            hls.on(Hls.Events.ERROR, function (event, data) {
                var errorType = data.type;
                var errorDetails = data.details;
                var errorFatal = data.fatal;
                
                console.error("HLS Error:", errorDetails, "Type:", errorType, "Fatal:", errorFatal);

                if (errorFatal) {
                    // หากเป็นข้อผิดพลาดร้ายแรง อาจจะต้องลองโหลดใหม่
                    switch (errorType) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            console.error("Fatal network error encountered, trying to recover...");
                            hls.startLoad();
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            console.error("Fatal media error encountered, trying to recover...");
                            hls.recoverMediaError();
                            break;
                        default:
                            // ไม่สามารถกู้คืนได้, ทำลายอินสแตนซ์และแจ้งผู้ใช้
                            hls.destroy();
                            alert("Cannot play the stream due to a fatal error.");
                            break;
                    }
                }
            });

        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // หากเบราว์เซอร์รองรับ HLS โดยตรง (เช่น Safari)
            console.log("Browser supports HLS natively.");
            video.src = videoUrl;
            // video.addEventListener('loadedmetadata', function() {
            //     video.play();
            // });
        } else {
            // กรณีที่เบราว์เซอร์ไม่รองรับ HLS เลย (หายากมากในปัจจุบัน)
            alert("Your browser does not support HLS streaming.");
        }
    </script>

</body>
</html>
