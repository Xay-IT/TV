<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CH3 HD Live Stream</title>
    <!-- 1. Viewport for responsive design (Mandatory) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 2. Tailwind CSS for modern styling (Mandatory) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ensure the body and html take up full height/width */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        /* Style the player container to take up the full available space */
        #player-container {
            width: 100%;
            height: 100vh; /* Viewport height */
            background-color: #000;
        }
        /* Custom font for aesthetics */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900">

    <!-- Player container takes the full screen -->
    <div id="player-container"></div>

    <!-- Channel Name Overlay -->
    <span class="absolute top-4 left-4 p-2 bg-red-700/80 text-white text-xl font-bold rounded-lg shadow-xl z-10 sm:top-6 sm:left-6">
        ໄຊ Live HD
    </span>

    <!-- 3. Load Clappr and required HLS plugins - MOVED TO END OF BODY -->
    <script src="//cdn.jsdelivr.net/npm/@clappr/player@0.4.0/dist/clappr.min.js"></script>
    <!-- Use Hls.js library for robust HLS playback -->
    <script src="//cdn.jsdelivr.net/npm/hls.js@latest/dist/hls.min.js"></script>
    <!-- Clappr Hls.js plugin to integrate Hls.js into Clappr -->
    <script src="//cdn.jsdelivr.net/npm/clappr-hlsjs-plugin@latest/dist/clappr-hlsjs-plugin.min.js"></script>
    <!-- LevelSelector for quality switching in HLS -->
    <script src="//cdn.jsdelivr.net/npm/level-selector@latest/dist/level-selector.min.js"></script>

    <script>
        // Use a polling mechanism to ensure Clappr is defined before initialization
        
        function initializePlayer() {
            // New Log: Confirm initialization function is running.
            console.log("Player initialization sequence started.");
            
            // Configuration for the video player
            var player = new Clappr.Player({
                // The HLS source URL (.m3u8)
                source: 'http://119.59.118.159/live/ch46/xxccxgd134/index.m3u8',

                // Set the correct MIME type for HLS
                mimeType: 'application/x-mpegURL',

                // Player dimensions (100% of the container)
                height: '100%',
                width: '100%',

                // Start playing automatically
                autoPlay: true,
                
                // Keep LevelSelector and use HlsjsPlayback for reliable HLS streaming
                plugins: [LevelSelector, HlsjsPlayback],

                // Disable click-to-pause (optional, based on original request)
                events: {
                    onReady: function() {
                        var plugin = this.getPlugin('click_to_pause');
                        plugin && plugin.disable();
                        console.log("Clappr Player is Ready.");
                    },
                },

                // Configuration for the HlsjsPlayback plugin (optional but improves HLS stability)
                playback: {
                    hlsjsConfig: {
                        // Increase live latency for smoother playback (e.g., 5 seconds)
                        liveSyncDuration: 5,
                        enableWorker: true
                    }
                },

                // Point the player to the dedicated container ID
                parentId: '#player-container'
            });

            // Note for the user if the stream fails to load due to external factors
            player.on(Clappr.Events.PLAYBACK_ERROR, function(e) {
                console.error("Playback error detected:", e);
                const container = document.getElementById('player-container');
                if (container) {
                    container.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full text-white p-6 bg-black">
                            <svg class="w-12 h-12 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path></svg>
                            <h2 class="text-2xl font-semibold mb-2">ข้อผิดพลาดในการเล่น (Playback Error)</h2>
                            <p class="text-center text-gray-400">
                                วิดีโอไม่สามารถเล่นได้ สาเหตุอาจเกิดจาก:
                                <ul class="list-disc list-inside mt-2 text-left">
                                    <li>URL สตรีมอาจถูกยกเลิก (Offline)</li>
                                    <li>การจำกัดการเข้าถึง (Geo-blocked)</li>
                                    <li>ปัญหาเครือข่ายของผู้ใช้เอง</li>
                                </ul>
                                ตรวจสอบให้แน่ใจว่า URL สตรีมยังใช้งานได้ครับ
                            </p>
                        </div>
                    `;
                }
            });
        }

        // Wait function using polling
        function waitForClappr() {
            // Check if Clappr and required plugins are defined globally
            if (typeof Clappr !== 'undefined' && typeof LevelSelector !== 'undefined' && typeof HlsjsPlayback !== 'undefined') {
                console.log("Clappr and plugins are defined. Starting player initialization.");
                initializePlayer();
            } else {
                // If not defined, check again in 100 milliseconds
                setTimeout(waitForClappr, 100);
            }
        }

        // Start the wait process
        waitForClappr();
    </script>
</body>
</html>
